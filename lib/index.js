// Generated by CoffeeScript 1.8.0
(function() {
  var Qiita, request;

  request = require('superagent');

  Qiita = require('../kitchen/qiita');

  Qiita.setToken = function(token) {
    return Qiita._token = token;
  };

  Qiita.setEndpoint = function(endpoint) {
    return Qiita._endpoint = endpoint;
  };

  Qiita.setUserAgent = function(ua) {
    return Qiita._ua = ua;
  };

  Qiita.setRequester(function(method, api, params) {
    if (typeof Promise === "undefined" || Promise === null) {
      return new Promise.reject('You should require promise or its shim');
    }
    return new Promise(function(done, reject) {
      var req, url, _ref;
      url = Qiita._endpoint + api;
      req = method === 'GET' ? request.get(url).query(params) : request[method.toLowerCase()](url).send(params);
      return req.set({
        Authorization: 'Bearer ' + Qiita._token
      }).set('Accept', 'application/json').set('User-Agent', (_ref = Qiita._ua) != null ? _ref : 'qiita-js/0.2').end(function(error, res) {
        if (error) {
          return reject(error);
        }
        if (parseInt(res.statusCode, 10) >= 400) {
          error = new Error('qiita-js request error:' + method + ' ' + url + '\n' + res.body.error);
          return reject(error);
        }
        return done(res.body);
      });
    });
  });

  module.exports = Qiita;

}).call(this);
